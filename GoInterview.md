## 一、面试题

1、MySQL 之 SQL 优化。



2、索引如何建？

- 最左前缀
- 根据最大区分度建立索引



3、索引结构？

- B+Tree



4、Redis 缓存一致性问题？



5、线上 Go 内存泄露？

- proof 工具

  

6、Go CSP 模型？

通过通信来共享数据，而不是通过共享内存来通信。



7、逃逸分析

通过命令 `go run -gcflags="-m -l" main.go` 观察golang是如何进行逃逸分析的。



8、哪些情况会 panic ？

- 数组越界
- 向已关闭的管道发送数据；
- 关闭已关闭的管道；
- 解未上锁的锁；
- Map 未分配内存直接使用。



9、Go语言实现线程安全常用的几种方式：

1. 互斥锁
2. 读写锁
3. 原子操作
4. sync.once
5. sync.atomic
6. channel



10、读书工具 MarginNote 3

画图 OmniGraffiti



11、评论系统架构设计

- 功能模块
- 架构设计
- 存储设计
- 可用性设计





## 二、项目经历

### 1、图像存储服务（ISS）

- 痛点：随着时间的推移，服务器上的“垃圾”图像越来越多，如未引用的、重复的图像，这些图像无法得到有效的管理，会占用大量的系统资源。

- 实现：

  - 用 DB 记录上传图像（重要字段：id、hash、ref_count）；

  - 新上传的图像首先经过 sha256 计算文件 hash 值，若数据表中存在该 hash，直接返回上传成功和 image_id；
  - 上传图像的 ref_count 初始值为 0；
  - 当有对象引用该图像时 ref_count + 1，对象中存储引用图像的 id；
  - 当有对象删除、替换图像时 ref_count - 1；
  - 最终可以通过 ref_count = 0 判定该图像为垃圾。

- 参考：
  - 网盘设计；
  - 文件校验和；
  - Redis 垃圾回收机制；



### 2、聊天服务（IM）

- ChatHub：负责处理 Client 的上下线业务，管理所有在线的 Clients，转发消息等。
- Client：每个 Client 开启两个 Goroutine，一个负责收消息、一个负责发消息。并在内部维护一个待发缓冲区，解决读写速度不对等的问题。
- Kafka 解耦：系统消息属于特殊消息，无法通过 SystemClient 发送（需登录验证），利用 Kafka 可以完美实现业务解耦。
- Kafka 顺序消费：系统消息有一定的顺序性，通过指定消息 Key（to_id），保证消费顺序。
- Kafka 缓冲削峰：大量消息涌入，会阻塞在 ChatHub  中，进而导致 Sender 阻塞。先将大量消息丢入 Kafka，再根据 ChatHub 的实际能力消费处理，增加消费者解决。

- 细节：定时 PING 、已读回执。

## 三、工作经验

### 1、HS

1、统一项目规范、目录结构，响应方法 Success 与 Fail。

2、文章管理模块：无限级文章结构，parentid、path。

3、聊天服务。

4、安全验证阶段的巧妙设计。

5、多语言管理的统一。

6、现货交易、合约交易、C2C交易模块的开发。

### 2、DX